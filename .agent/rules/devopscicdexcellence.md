---
trigger: always_on
---

{
  "messages": [
    {
      "role": "system",
      "content": "====================\nDEVOPS & CI/CD EXCELLENCE RULES\n====================\n\n**MISSION:** Automate everything, deploy safely, recover quickly, and maintain high availability.\n\n====================\n1) INFRASTRUCTURE AS CODE (IAC) STANDARDS\n====================\n**Core Principles:**\n- **Declarative Configuration:** Describe desired state, not steps\n- **Idempotency:** Apply same configuration multiple times safely\n- **Version Control:** All infrastructure code in Git\n- **Modularity:** Reusable, composable modules\n- **Testing:** Infrastructure code tested like application code\n\n**IAC Tool Standards:**\n- **Terraform:** For cloud resource provisioning\n- **AWS CloudFormation:** For AWS-native stacks\n- **Azure ARM Templates:** For Azure deployments\n- **Google Deployment Manager:** For GCP resources\n- **Ansible/Puppet/Chef:** For configuration management\n- **Docker:** For containerization\n- **Kubernetes Manifests/Helm:** For container orchestration\n\n**IAC Best Practices:**\n- Use remote state storage with locking\n- Separate environments (dev, staging, prod)\n- Variable files for environment differences\n- Module registry for reusable components\n- Regular `terraform fmt` and `terraform validate`\n- State file encryption and backup\n\n====================\n2) CI/CD PIPELINE OPTIMIZATION\n====================\n**Pipeline Structure:**\n```yaml\nStages:\n  1. Lint & Format      # Code quality\n  2. Unit Tests         # Fast feedback\n  3. Build              # Artifact creation\n  4. Integration Tests  # Component integration\n  5. Security Scan      # SAST, SCA, container scan\n  6. Deploy to Dev      # Automated deployment\n  7. E2E Tests          # Full system testing\n  8. Deploy to Staging  # Manual approval gate\n  9. Performance Tests  # Load and stress testing\n  10. Deploy to Prod    # With canary/blue-green\n  11. Post-Deploy       # Smoke tests, monitoring\n```\n\n**Pipeline Optimization:**\n- **Parallel Execution:** Run independent stages in parallel\n- **Caching:** Cache dependencies, build artifacts\n- **Incremental Builds:** Only rebuild changed components\n- **Artifact Management:** Store and version artifacts\n- **Pipeline as Code:** Define pipelines in repository\n- **Self-Healing Pipelines:** Auto-retry on transient failures\n\n**CI/CD Tools:**\n- **GitHub Actions:** For GitHub repositories\n- **GitLab CI/CD:** Integrated with GitLab\n- **Jenkins:** Flexible, extensible\n- **CircleCI:** Cloud-native\n- **AWS CodePipeline:** AWS integrated\n- **Azure DevOps:** Microsoft ecosystem\n\n====================\n3) DEPLOYMENT STRATEGIES\n====================\n**Blue-Green Deployment:**\n- Two identical environments (blue and green)\n- Route traffic to one at a time\n- Zero downtime deployments\n- Instant rollback by switching traffic\n- Database migration compatibility required\n\n**Canary Deployment:**\n- Gradual traffic shift (1% → 5% → 25% → 100%)\n- Monitor metrics at each stage\n- Rollback if issues detected\n- User segmentation possible (internal users first)\n- A/B testing integration\n\n**Rolling Update:**\n- Update instances one by one\n- Maintain service availability\n- Automatic health checks\n- Rollback on failure\n- Simple but slower than blue-green\n\n**Feature Flags/Toggles:**\n- Decouple deployment from release\n- Enable/disable features without redeploy\n- Targeted user groups\n- Kill switches for problematic features\n- Experimentation framework\n\n**Dark Launching:**\n- Deploy code but don't expose functionality\n- Test in production with shadow traffic\n- Performance testing with real data\n- Zero user impact during testing\n\n====================\n4) ENVIRONMENT MANAGEMENT\n====================\n**Environment Types:**\n- **Local:** Developer machines\n- **Development:** Shared dev environment\n- **Integration:** For feature integration\n- **Staging:** Production-like for testing\n- **Production:** Live user environment\n- **Disaster Recovery:** Backup production\n- **Performance/Load:** Stress testing\n- **Feature Branches:** Per-PR environments\n\n**Environment Consistency:**\n- Same infrastructure code for all environments\n- Configuration differences in variables only\n- Database seeding strategies\n- Data anonymization for non-prod\n- Environment promotion pipeline\n\n**Cost Management:**\n- Auto-shutdown dev environments after hours\n- Spot instances for non-critical environments\n- Resource tagging for cost allocation\n- Regular cleanup of unused resources\n- Budget alerts and limits\n\n====================\n5) SECRET MANAGEMENT\n====================\n**Secret Management Principles:**\n- Never store secrets in code\n- Never log secrets\n- Rotate secrets regularly\n- Least privilege access\n- Audit all secret access\n\n**Secret Management Tools:**\n- **HashiCorp Vault:** Enterprise-grade\n- **AWS Secrets Manager:** AWS integrated\n- **Azure Key Vault:** Azure integrated\n- **Google Secret Manager:** GCP integrated\n- **Bitwarden:** Open source option\n\n**Secret Injection Methods:**\n- Environment variables at runtime\n- Volume mounts for containers\n- API calls from application\n- Sidecar containers in Kubernetes\n- CI/CD pipeline integration\n\n**Secret Rotation:**\n- Automated rotation schedules\n- Zero-downtime rotation\n- Multiple secret versions support\n- Application reload without restart\n- Emergency rotation procedures\n\n====================\n6) DISASTER RECOVERY (DR) & BUSINESS CONTINUITY\n====================\n**DR Planning:**\n- **RTO (Recovery Time Objective):** Maximum acceptable downtime\n- **RPO (Recovery Point Objective):** Maximum data loss acceptable\n- **Recovery Strategies:** Backup/restore, pilot light, warm standby, multi-site\n- **DR Runbooks:** Step-by-step recovery procedures\n- **Regular DR Drills:** Test recovery quarterly\n\n**Backup Strategies:**\n- **Full Backups:** Complete system state\n- **Incremental Backups:** Changes since last backup\n- **Continuous Backup:** Real-time data protection\n- **Geographic Distribution:** Multiple regions\n- **Backup Validation:** Regular restore testing\n\n**High Availability Architecture:**\n- Multiple availability zones/regions\n- Load balancing with health checks\n- Auto-scaling groups\n- Database replication (master-slave, multi-master)\n- CDN for static assets\n\n**Monitoring & Alerting for DR:**\n- Health checks for all components\n- Synthetic transactions\n- Business metrics monitoring\n- Escalation policies\n- Automated failover where possible"
    }
  ]
}