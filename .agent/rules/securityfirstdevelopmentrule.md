---
trigger: always_on
---

{
  "messages": [
    {
      "role": "system",
      "content": "====================\nSECURITY-FIRST DEVELOPMENT RULES\n====================\n\n**MISSION:** Build inherently secure systems by design, not as an afterthought.\n\n====================\n1) SECURITY BY DESIGN PRINCIPLES\n====================\n**Core Principles:**\n- **Least Privilege:** Grant minimum necessary permissions\n- **Defense in Depth:** Multiple security layers\n- **Fail Securely:** Handle failures without exposing data\n- **Economy of Mechanism:** Keep security simple\n- **Complete Mediation:** Check every access, every time\n- **Open Design:** Security through obscurity is not security\n- **Separation of Duties:** Critical operations require multiple people\n- **Psychological Acceptability:** Security shouldn't hinder usability\n\n**Security Requirements:**\n- Define security requirements alongside functional requirements\n- Include security in user stories and acceptance criteria\n- Security testing as part of definition of done\n- Threat modeling for every feature\n\n====================\n2) AUTHENTICATION & AUTHORIZATION\n====================\n**Authentication Standards:**\n- Multi-factor authentication (MFA) mandatory for admin access\n- Password policies: min 12 chars, complexity, no reuse\n- Password hashing: Argon2id or bcrypt with proper work factors\n- Account lockout after 5 failed attempts (with safe reset)\n- Session management: Secure, HttpOnly, SameSite cookies\n\n**Authorization Patterns:**\n- Role-Based Access Control (RBAC) for simple systems\n- Attribute-Based Access Control (ABAC) for complex rules\n- Policy-Based Access Control for dynamic requirements\n- OAuth 2.0 scopes for API authorization\n\n**Token Management:**\n- JWT with short expiry (15-60 minutes)\n- Refresh tokens with revocation capability\n- Token binding to prevent token theft\n- Secure token storage (never in localStorage)\n\n====================\n3) INPUT VALIDATION & SANITIZATION\n====================\n**Validation Rules:**\n- Validate on client for UX, validate on server for security\n- Whitelist allowed characters, don't blacklist bad ones\n- Validate data type, length, format, and range\n- Business rule validation at application layer\n\n**Common Attacks Prevention:**\n- **SQL Injection:** Parameterized queries ONLY, no string concatenation\n- **XSS:** Output encoding, Content Security Policy (CSP)\n- **CSRF:** Anti-CSRF tokens, SameSite cookies\n- **SSRF:** Whitelist allowed URLs, network segmentation\n- **XXE:** Disable XML external entities, use JSON instead\n- **Command Injection:** Avoid system calls, use library functions\n\n**File Upload Security:**\n- Validate file type by content, not extension\n- Scan for malware\n- Store outside web root\n- Generate unique filenames\n- Set proper permissions\n\n====================\n4) DATA PROTECTION & ENCRYPTION\n====================\n**Encryption Standards:**\n- **At Rest:** AES-256-GCM for symmetric, RSA-2048+ for asymmetric\n- **In Transit:** TLS 1.3 only, perfect forward secrecy\n- **Key Management:** Hardware Security Module (HSM) or cloud KMS\n- **Key Rotation:** Automatic, regular rotation\n\n**Sensitive Data Handling:**\n- Identify PII, PCI, HIPAA data\n- Data classification: Public, Internal, Confidential, Restricted\n- Data masking for non-production environments\n- Data retention and deletion policies\n- Logs must not contain sensitive data\n\n**Database Security:**\n- Encrypt sensitive columns\n- Row-level security where appropriate\n- Database activity monitoring\n- Regular security patches\n\n====================\n5) API SECURITY\n====================\n**API Protection:**\n- Rate limiting per API key/IP/user\n- Request size limits\n- Input validation for all parameters\n- Output filtering to prevent data leakage\n\n**API Authentication:**\n- API keys with limited scope and expiry\n- OAuth 2.0 for user-delegated access\n- Mutual TLS for service-to-service\n- JWT for stateless authentication\n\n**API Security Headers:**\n- Strict-Transport-Security (HSTS)\n- Content-Security-Policy (CSP)\n- X-Content-Type-Options: nosniff\n- X-Frame-Options: DENY\n- Referrer-Policy: strict-origin-when-cross-origin\n\n====================\n6) INFRASTRUCTURE SECURITY\n====================\n**Cloud Security:**\n- Principle of least privilege for IAM roles\n- Network segmentation (VPC, subnets, security groups)\n- Encrypted EBS volumes and S3 buckets\n- CloudTrail logging enabled\n- GuardDuty for threat detection\n\n**Container Security:**\n- Use minimal base images (Alpine, Distroless)\n- Non-root user inside containers\n- Read-only root filesystem where possible\n- Regular vulnerability scanning\n- Image signing and verification\n\n**Kubernetes Security:**\n- Pod Security Standards (Restricted profile)\n- Network policies for pod communication\n- Secrets management (not in config maps)\n- Regular kubectl audit\n\n====================\n7) SECURE DEVELOPMENT LIFECYCLE\n====================\n**SDLC Integration:**\n- **Requirements:** Security requirements gathering\n- **Design:** Threat modeling, security architecture\n- **Implementation:** Secure coding standards, peer review\n- **Testing:** SAST, DAST, penetration testing\n- **Deployment:** Secure configuration, infrastructure as code\n- **Operations:** Monitoring, incident response, patches\n\n**Security Tools Pipeline:**\n- **SAST:** SonarQube, Checkmarx, Fortify\n- **DAST:** OWASP ZAP, Burp Suite\n- **SCA:** Snyk, WhiteSource, Dependabot\n- **Container Scanning:** Trivy, Clair, Twistlock\n- **Infrastructure Scanning:** Terraform Cloud, Checkov\n\n====================\n8) THREAT MODELING PROCESS\n====================\n**STRIDE Methodology:**\n- **Spoofing:** Authentication threats\n- **Tampering:** Integrity threats\n- **Repudiation:** Non-repudiation threats\n- **Information Disclosure:** Confidentiality threats\n- **Denial of Service:** Availability threats\n- **Elevation of Privilege:** Authorization threats\n\n**Threat Modeling Steps:**\n1. Diagram the system\n2. Identify threats (STRIDE)\n3. Mitigate threats\n4. Validate mitigations\n5. Document and track\n\n**Threat Modeling Tools:**\n- Microsoft Threat Modeling Tool\n- OWASP Threat Dragon\n- IriusRisk\n- ThreatSpec\n\n====================\n9) SECURITY TESTING\n====================\n**Testing Types:**\n- **Static Analysis (SAST):** Code without executing\n- **Dynamic Analysis (DAST):** Running application testing\n- **Interactive Analysis (IAST):** Combination of SAST/DAST\n- **Software Composition Analysis (SCA):** Dependency checking\n- **Penetration Testing:** Manual expert testing\n- **Bug Bounty:** Crowdsourced security testing\n\n**OWASP Top 10 Testing:**\n- A1: Injection\n- A2: Broken Authentication\n- A3: Sensitive Data Exposure\n- A4: XML External Entities (XXE)\n- A5: Broken Access Control\n- A6: Security Misconfiguration\n- A7: Cross-Site Scripting (XSS)\n- A8: Insecure Deserialization\n- A9: Using Components with Known Vulnerabilities\n- A10: Insufficient Logging & Monitoring\n\n====================\n10) INCIDENT RESPONSE PREPAREDNESS\n====================\n**Incident Response Plan:**\n- **Preparation:** Tools, contacts, runbooks\n- **Identification:** Detection and analysis\n- **Containment:** Short-term and long-term\n- **Eradication:** Remove threat cause\n- **Recovery:** Restore systems\n- **Lessons Learned:** Post-incident review\n\n**Monitoring for Security:**\n- SIEM system (Splunk, Elastic, Azure Sentinel)\n- IDS/IPS (network and host-based)\n- Anomaly detection (user behavior, traffic patterns)\n- Log aggregation and analysis\n\n**Forensics Readiness:**\n- Comprehensive logging\n- Chain of custody procedures\n- Evidence preservation\n- Timeline reconstruction capability\n\n====================\n11) COMPLIANCE & STANDARDS\n====================\n**Common Standards:**\n- **OWASP ASVS:** Application Security Verification Standard\n- **NIST CSF:** Cybersecurity Framework\n- **ISO 27001:** Information Security Management\n- **SOC 2:** Trust Services Criteria\n- **GDPR:** Data protection and privacy\n- **PCI DSS:** Payment card industry\n- **HIPAA:** Healthcare information\n\n**Compliance Automation:**\n- Policy as code\n- Continuous compliance monitoring\n- Automated evidence collection\n- Regular audit preparation\n\n====================\n12) SECURITY CULTURE\n====================\n**Building Security Culture:**\n- Security champions program\n- Regular security training\n- Secure coding workshops\n- Capture the flag exercises\n- Security newsletters and updates\n\n**Metrics and Measurement:**\n- Mean time to detect (MTTD)\n- Mean time to respond (MTTR)\n- Security debt tracking\n- Training completion rates\n- Vulnerability recurrence rates\n\n====================\nFINAL COMMANDMENT: SECURITY IS EVERYONE'S JOB\n====================\n\"Security is not a feature, it's a property.\nSecurity is not a phase, it's a process.\nSecurity is not an expense, it's an investment.\nSecurity is not optional, it's essential.\"\n\n**Remember:** It's not if you'll be attacked, but when. Be prepared.\""
    }
  ]
}